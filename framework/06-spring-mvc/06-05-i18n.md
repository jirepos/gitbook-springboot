# ë‹¤êµ­ì–´ ì²˜ë¦¬


ìŠ¤í”„ë§ ì œê³µí•˜ëŠ” spring:message ì»¤ìŠ¤í…€ íƒœê·¸ëŠ” ì›¹ ìš”ì²­ê³¼ ê´€ë ¨ëœ ì–¸ì–´ ì •ë³´ë¥¼ ì´ìš©í•´ì„œ ì•Œë§ì€ ì–¸ì–´ì˜ ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•œë‹¤. ì›¹ ë¸Œë¼ìš°ì €ì˜ ì–¸ì–´ ì„¤ì •ì„ í•œêµ­ì–´(ko_kr)ë¡œ í–ˆì„ ë•Œì™€ ì˜ì–´(en_us)ë¡œ í–ˆì„ ë•Œ spring:message ì»¤ìŠ¤í…€ íƒœê·¸ê°€ ì–¸ì–´ì— ë”°ë¼ ì•Œë§ì€ ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•´ ì£¼ëŠ” ê²°ê³¼ í™”ë©´ì„ ë³´ì—¬ì¤€ë‹¤.

Spring MVCëŠ” LocaleResolverë¥¼ ì´ìš©í•´ì„œ ì›¹ ìš”ì²­ê³¼ ê´€ë ¨í•´ì„œ Localeì„ ì¶”ì¶œí•˜ê³  ì´ Locale ê°ì²´ë¥¼ ì´ìš©í•´ì„œ ì•Œë§ì€ ì–¸ì–´ì˜ ë©”ì‹œì§€ë¥¼ ì„ íƒí•œë‹¤.

**LocaleResolver ì¢…ë¥˜**

**AcceptHeaderLocaleResolver**

ì›¹ ë¸Œë¼ìš°ì €ê°€ ì „ì†¡í•œ Accept-Language í—¤ë”ë¡œë¶€í„° Localeì„ ì„ íƒ

**CookieLocaleResolveer**

ì¿ í‚¤ë¥¼ ì´ìš©í•´ì„œ Locale ì •ë³´ êµ¬í•¨. setLocale() ë©”ì†Œë“œëŠ” ì¿ í‚¤ì— Locale ì •ë³´ë¥¼ ì €ì¥í•¨

**SessionLocaleResolver**

ì„¸ì…˜ìœ¼ë¡œë¶€í„° Locale ì •ë³´ë¥¼ êµ¬í•¨. setLocale() ë©”ì†Œë“œëŠ” ì„¸ì…˜ì— Locale ì •ë³´ë¥¼ ì €ì¥í•¨

**FixedLocaleResolver**

ê³ ì • Localeì„ ì‚¬ìš©í•¨. setLocale() ë©”ì†Œë“œê°€ ì—†ìŒ

**Locale ì „ëµ**
ì‚¬ìš©ìì˜ PC í™˜ê²½ì˜ Locale ì„¤ì •ì— ë”°ë¥¸ Localeì„ ì‚¬ìš©í•˜ë©´ ì‚¬ìš©ìê°€ ë‹¤ë¥¸ ì–¸ì–´ë¡œ ì›¹í˜ì´ì§€ë¥¼ ë³´ê³  ì‹¶ì„ ë•Œ ë³€ê²½í•  ìˆ˜ ì—†ë‹¤. ì‚¬ìš©ìê°€ ìì‹ ì˜ PCì˜ Localeì— ê´€ê³„ì—†ì´ ì–¸ì–´ ì„¤ì •ì„ ë³€ê²½í•˜ë ¤ê³  í•  ë•Œ ë³€ê²½í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤. ê·¸ë˜ì„œ Cookieë¥¼ ì´ìš©í•œ Locale ì„¤ì •ì´ ì í•©í•˜ë‹¤.

**LocaleResolver ìƒì„±** com.sogood.core.config íŒ¨í‚¤ì§€ì˜ DispatcherConfig.java íŒŒì¼ì„ ì—´ê³  ë‹¤ìŒì„ ì¶”ê°€í•œë‹¤.

```java
@EnableWebMvc
@Configuration
public class DispatcherConfig implements WebMvcConfigurer {
  @Bean
  public CookieLocaleResolver localeResolver() {
    CookieLocaleResolver localeResolver = new CookieLocaleResolver();
    localeResolver.setDefaultLocale(Locale.KOREA); // ê¸°ë³¸ í•œêµ­ì–´
    localeResolver.setCookieName("locale"); // ì¿ í‚¤ ì´ë¦„ ; locale
    localeResolver.setCookieMaxAge(60 * 60); // ì¿ í‚¤ ì‚´ë ¤ë‘˜ ì‹œê°„, -1ë¡œ í•˜ë©´ ë¸Œë¼ìš°ì ¸ë¥¼ ë‹«ì„ ë•Œ ì—†ì–´ì§.
    localeResolver.setCookiePath("/"); // Pathë¥¼ ì§€ì •í•´ ì£¼ë©´ í•´ë‹¹í•˜ëŠ” pathì™€ ê·¸ í•˜ìœ„ pathì—ì„œë§Œ ì°¸ì¡°
    return localeResolver;
  }//:
}
```

ìœ„ì™€ ê°™ì´ ì •ì˜í•˜ë©´ Springì€ ë‹¤êµ­ì–´ ë©”ì‹œì§€íŒŒì¼ì„ ì½ì„ ë•Œ Cookikeì˜ 'locale' ê°’ì„ ì½ì–´ì„œ ì–´ë–¤ ì–¸ì–´ì˜ ë©”ì‹œì§€ë¥¼ ê°€ì ¸ì˜¬ì§€ë¥¼ ê²°ì •í•œë‹¤. ê·¸ëŸ°ë° ì´ ì‹œì ì—ì„œ SpringBootë¥¼ ë‹¤ì‹œ ì‹œì‘í•˜ë©´ Bean ì´ë¦„ì´ ì¤‘ë³µë˜ì—ˆê³  overridingì´ ì•ˆëœë‹¤ëŠ” ë©”ì‹œì§€ê°€ ì¶œë ¥ëœë‹¤. Spring Boot 2.1ë¶€í„°ëŠ” ê°™ì€ ì´ë¦„ìœ¼ë¡œ Beanì„ ìƒì„±í•˜ëŠ” ê²ƒì´ ë””í´íŠ¸ë¡œ disabled ë˜ì—ˆë‹¤. ìš°ì—°íˆ ë¯¸ë¦¬ ì •ì˜ëœ beanì´ ì¤‘ë³µë˜ëŠ” ê²ƒì„ ë§‰ê¸° ìœ„í•´ì„œ ì•Œë ¤ì£¼ëŠ” ê²ƒì´ë‹¤. ì´ê²ƒì„ í•´ê²°í•˜ë ¤ë©´ ì´ë¦„ì„ ë°”ê¾¸ë˜ê°€ applicaiton.ymlì— spring.main.allow-bean-definition-overriding ì†ì„±ì„ trueí•œë‹¤.

í™•ì¸í•´ ë³´ë‹ˆ SpringBootëŠ” ë””í´íŠ¸ë¡œ AcceptHeaderLocaleResolverë¥¼ ì‚¬ìš©í•œë‹¤.

```java
spring:
  main:
    #spring.main.allow-bean-definition-overriding=true    
    allow-bean-definition-overriding: true
```

CookieLocaleResolverì˜ ì¿ í‚¤ ì„¤ì • ê´€ë ¨ í”„ë¡œí¼í‹°

cookieName

ì‚¬ìš©í•  ì¿ í‚¤ ì´ë¦„

cookieDomain

ì¿ í‚¤ ë„ë©”ì¸

cookiePath

ì¿ í‚¤ ê²½ë¡œ, ê¸°ë³¸ê°’ì€ "/"ì´ë‹¤.

cookieMaxAge

ì¿ í‚¤ ìœ íš¨ ì‹œê°„

cookieSecure

ë³´ì•ˆ ì¿ í‚¤ ì—¬ë¶€, ê¸°ë³¸ê°’ì€ false.

# ë‹¤êµ­ì–´ ë©”ì‹œì§€ ì‘ì„±

## properties íŒŒì¼ì„ ì´ìš©í•˜ëŠ” ë°©ë²•

ë‹¤êµ­ì–´ ë©”ì‹œì§€ëŠ” src/main/resources ì†ŒìŠ¤í´ë”ì— properties íŒŒì¼ë¡œ ì‘ì„±í•œë‹¤. ì´ í´ë”ì— translation íŒ¨í‚¤ì§€ë¥¼ ìƒì„±í•œë‹¤.

```java
ğŸ“src/main/resources
   ğŸ“translation
     ğŸ“demo

```

ë‹¤êµ­ì–´ ë©”ì‹œì§€ íŒŒì¼ì˜ íŒŒì¼ëª…ì˜ í˜•ì‹ì€ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•´ì•¼ í•œë‹¤.

```java
íŒŒì¼ëª…_[locale].properties
```

localì´ ì—†ì´ íŒŒì¼ëª…ì„ ì‘ì„±í•  ìˆ˜ë„ ìˆë‹¤. ì˜ˆë¥¼ë“¤ì–´ ë‹¤ìŒê³¼ ê°™ë‹¤.

```java
íŒŒì¼ëª….properties
```

ìœ„ì™€ ê°™ì´ localeì´ ë¶™ì§€ ì•Šì€ íŒŒì¼ì€ default ë©”ì‹œì§€ íŒŒì¼ì´ë‹¤. ì‚¬ìš©ìê°€ ì„ íƒí•œ localeì´ ì´ ì—†ì„ ê²½ìš° ë””í´íŠ¸ë¥¼ ì„ íƒí•œë‹¤. í•œêµ­ì–´, ì¼ë³¸ì–´, ì˜ì–´ë¥¼ ì§€ì›í•œë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ íŒŒì¼ë“¤ì„ ìƒì„±í•´ì•¼ í•œë‹¤.

```java
ğŸ“src/main/resources
   ğŸ“com
     ğŸ“translation
        ğŸ“demo
          ğŸ“„ demo-msg_ko.properties
          ğŸ“„ demo-msg_en.properties
          ğŸ“„ demo-msg_ja.properties
          ğŸ“„ demo-msg.properties
```

ë‹¤êµ­ì–´ íŒŒì¼ì— helloë¼ëŠ” í”„ëŸ¬í¼í‹°ë¥¼ í•˜ë‚˜ ì¶”ê°€í•œë‹¤.

```java
common:
  error:
    msg: System Error
```

```java
common:
  error:
    msg: System Error
```

ì´ì œ hello ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•´ë³´ì. MessageSourceë¥¼ í•„ë“œ ë©¤ë²„ë¡œ getMessage() ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë©”ì‹œì§€ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤. MessageSourceì˜ ìì„¸í•œ ì‚¬ìš©ë°©ë²•ì€ ì„¤ëª…í•˜ì§€ ì•ŠëŠ”ë‹¤. ì•„ë˜ ì½”ë“œì—ì„œëŠ” Locale.getDefault()ë¥¼ ì‚¬ìš©í–ˆì§€ë§Œ ì‹¤ì œ ì½”ë“œë¥¼ ì‘ì„±í•  ë•Œì—ëŠ” RequestContextUtilsë¥¼ ì‚¬ìš©í•˜ì—¬ LocaleResolverë¡œë¶€í„° Localeì„ êµ¬í•´ì•¼ í•œë‹¤.

```java
// DemoController.java
package com.sogood.demo;
// ... ìƒëµ 
import org.springframework.context.MessageSource;

@Controller
public class DemoController {
  // ... ìƒëµ
	@Autowired 
	private MessageSource  messageSource; 

	@GetMapping("/demo")
	public String test(HttpServletRequest request) {
		logger.debug(messageSource.getMessage("common.error.msg", null, Locale.getDefault()));
		return "demo";
	}
}/// ~
```

## YAML íŒŒì¼ ì‚¬ìš©

ë‹¤êµ­ì–´ ë©”ì‹œì§€ëŠ” ê¸°ë³¸ìœ¼ë¡œ properties íŒŒì¼ì„ ì‚¬ìš©í•˜ì§€ë§Œ ê·¸ë£¹í•‘í•˜ê¸° í¸í•˜ê³  ì‚¬ëŒì´ ì½ê¸° í¸í•œ YAML íŒŒì¼ë¡œ ë©”ì§€ì§€ íŒŒì¼ì„ ë§Œë“œëŠ” ê²ƒì´ ì¢‹ë‹¤.

src/main/resources ì†ŒìŠ¤ í´ë” ì•„ë˜ì˜ com.sogood.i18n íŒ¨í‚¤ì§€ì— ë‹¤ìŒê³¼ ê°™ì´ yaml íŒŒì¼ì„ ìƒì„±í•œë‹¤.

```java
ğŸ“src/main/resources
   ğŸ“translation
     ğŸ“demo
       ğŸ“„ demo-msg_ko.properties
       ğŸ“„ demo-msg_en.properties
       ğŸ“„ demo-msg_ja.properties
       ğŸ“„ demo-msg.properties
       ğŸ“„ demo-common.properties
       ğŸ“„ demo-common_ko.properties
       ğŸ“„ demo-common_en.properties
```

ì–¸ì–´ ë³„ë¡œ ë‹¤ë¥´ê²Œ ë‹¤êµ­ì–´ ë©”ì‹œì§€ë¥¼ ë§Œë“ ë‹¤. ì˜ˆì œì—ì„œëŠ” ê°„ë‹¨íˆ í•˜ê¸° ìœ„í•´ ëª¨ë‘ ì˜ì–´ë¡œ ì…ë ¥í–ˆë‹¤. 

```java
# demo-common.yml
common:
  error:
    msg: System Error
```

```java
# demo-common_ko.yml
common:
  error:
    msg: System Error
```

```java
# demo-common_en.yml
common:
  error:
    msg: System Error
```

```java
# demo-common_ja.yml
common:
  error:
    msg: System Error
```

pom.xml íŒŒì¼ì„ ì—´ê³  ì˜ì¡´ì„±ì„ ì¶”ê°€í•œë‹¤.

```java
<dependency>
	<groupId>net.rakugakibox.util</groupId>
	<artifactId>yaml-resource-bundle</artifactId>
	<version>1.2</version>
</dependency>
```

com.sogood.core.util íŒ¨í‚¤ì§€ë¥¼ ìƒì„±í•˜ê³  ê·¸ ì•ˆì— YmlMessageSource.java íŒŒì¼ì„ ìƒì„±í•œ ë‹¤ìŒì— ë‹¤ìŒê³¼ ê°™ì´ ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤.

```java
package com.sogood.core.util;

import java.util.Locale;
import java.util.MissingResourceException;
import java.util.ResourceBundle;

import org.springframework.context.support.ResourceBundleMessageSource;

import net.rakugakibox.util.YamlResourceBundle;

public class YamlMessageSource extends ResourceBundleMessageSource {
  @Override
  protected ResourceBundle doGetBundle(String basename, Locale locale) throws MissingResourceException {
    return ResourceBundle.getBundle(basename, locale, YamlResourceBundle.Control.INSTANCE);
  }
}/// ~
```

com.sogood.core.config íŒ¨í‚¤ì§€ì˜ AppConfig.javaë¥¼ ì—´ê³  messageSource() ë©”ì†Œë“œë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ë³€ê²½í•œë‹¤.

```java
package com.sogood.core.config;

import com.sogood.core.util.YamlMessageSource;

import org.springframework.context.MessageSource;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class AppConfig {

  @Bean
  public MessageSource messageSource() {
    YamlMessageSource messageSource = new YamlMessageSource();
    messageSource.setDefaultEncoding("UTF-8");
    String[] basenames = new String[] {
      "translation/demo/demo-msg",
      "translation/demo/demo-common"
    };
    messageSource.setBasenames(basenames);
    return messageSource;
  }// :

}/// ~
```

ìœ„ ì½”ë“œì—ì„œ ì´ì „ê³¼ëŠ” ë‹¤ë¥´ê²Œ setBasename() ì´ ì•„ë‹Œ setBasenames()ë¥¼ ì‚¬ìš©í–ˆë‹¤. í”„ë¡œì íŠ¸ì˜ ê·œëª¨ê°€ í° ê²½ìš°ì— í•˜ë‚˜ì˜ ë©”ì‹œì§€ íŒŒì¼ë¡œ ì •ì˜í•˜ëŠ” ê²ƒì´ ì–´ë µê¸° ë•Œë¬¸ì— ë ¤ëŸ¬ê°œì˜ íŒŒì¼ë¡œ ë¶„ë¦¬í•  ìˆ˜ ìˆë‹¤.

DemoController.javaë¥¼ ì—´ê³  ë‹¤ìŒê³¼ ê°™ì´ ì½”ë“œë¥¼ ìˆ˜ì •í•œë‹¤.

```java
// DemoController.java
package com.sogood.demo;
// ... ìƒëµ 
import org.springframework.context.MessageSource;

@Controller
public class DemoController {
  // ... ìƒëµ
	@Autowired 
	private MessageSource  messageSource; 

	@GetMapping("/demo")
	public String test(HttpServletRequest request) {
		logger.debug(messageSource.getMessage("common.error.msg", null, Locale.getDefault()));
		return "demo";
	}
}/// ~
```

í”„ë¡œì íŠ¸ê°€ ì§„í–‰ë˜ë©´ ì²˜ìŒ ì„¤ê³„í•  ë•Œì™€ ë‹¬ë¦¬ ë©”ì‹œì§€ íŒŒì¼ì„ ì¶”ê°€í•  í•„ìš”ê°€ ìˆì„ ê²ƒì´ë‹¤. ì´ëŸ° ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ì„œ basenamesì˜ ê°’ì„ í•˜ë“œì½”ë”©í•˜ì§€ ì•ŠëŠ” ë°©ë²•ì´ í•„ìš”í•˜ë‹¤.

application.ymlíŒŒì¼ì„ ì—´ê³  ë‹¤ìŒê³¼ ê°™ì´ basenamesë¥¼ ì¶”ê°€í•œë‹¤.

```java
i18n-message-files: translation/demo/demo-msg,translation/demo/demo-common
```

ìœ„ì˜ ë°©ë²•ì€ ë³´ê¸° ì¢‹ì§€ ì•Šìœ¼ë¯€ë¡œ ì•„ë˜ì™€ ê°™ì´ YAMLì—ì„œ ì§€ì›í•˜ëŠ” í¬ë§·ìœ¼ë¡œ ë°”ê¾¸ë ¤ê³  í–ˆì§€ë§Œ ì˜¤ë¥˜ê°€ ë‚˜ì„œ ì¼ë‹¨ ì œì™¸í–ˆë‹¤. 

```java
i18n-messages:
  - com/sogood/i18n/message
  - com/sogood/i18n/common
```

ìœ„ì—ì„œ ì‘ì„±í•œ messageSource() ë©”ì†Œë“œë¥¼ '@Value'ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•œë‹¤.

```java
@Bean
  public MessageSource messageSource( @Value("${i18n-message-files}") List<String> basenames) {
    YamlMessageSource messageSource = new YamlMessageSource();
    messageSource.setDefaultEncoding("UTF-8");
    // String[] basenames = new String[] {
    //   "com/sogood/i18n/message",
    //   "com/sogood/i18n/common"
    // };
   String[] messageList = new String[basenames.size()];
    messageList = basenames.toArray(messageList);
    messageSource.setBasenames(messageList);
    return messageSource;
  }//
```

ì´ì œëŠ” ë‹¤êµ­ì–´ íŒŒì¼ì„ ì—¬ëŸ¬ ê°œ ì„¤ì •í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.